<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BTC 合约价差监控</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial; text-align: center; background: #0f0f0f; color: #fff; }
h1 { margin-top: 20px; }
.price-box { margin: 20px auto; width: 90%; padding: 15px; border: 1px solid #444; border-radius: 10px; }
.exchange { font-size: 1.2em; color: #0ff; }
.price { font-size: 1.8em; margin-top: 5px; }
canvas { background: #111; margin-top: 20px; border-radius: 10px; }
</style>
</head>
<body>
<h1>BTC 永续合约价差监控</h1>

<div class="price-box">
  <div class="exchange">Lighter</div>
  <div class="price" id="lighter">加载中...</div>
</div>

<div class="price-box">
  <div class="exchange">Paradex</div>
  <div class="price" id="paradex">加载中...</div>
</div>

<div class="price-box">
  <div class="exchange">价差 (Lighter - Paradex)</div>
  <div class="price" id="spread">加载中...</div>
</div>

<canvas id="spreadChart" width="400" height="200"></canvas>

<script>
const ctx = document.getElementById('spreadChart').getContext('2d');
const labels = [];
const dataPoints = [];
const spreadChart = new Chart(ctx, {
    type: 'line',
    data: { labels: labels, datasets: [{ label: '价差', data: dataPoints, borderColor: 'cyan', tension: 0.3 }] },
    options: { responsive: true, animation: false, scales: { y: { beginAtZero: false } } }
});

async function fetchPrices() {
    const res = await fetch('/api/prices');
    const data = await res.json();
    if (data.error) return;

    document.getElementById('lighter').textContent = data.lighter + ' USD';
    document.getElementById('paradex').textContent = data.paradex + ' USD';
    document.getElementById('spread').textContent = data.spread.toFixed(2) + ' USD';

    labels.push(data.time);
    dataPoints.push(data.spread.toFixed(2));
    if (labels.length > 30) { labels.shift(); dataPoints.shift(); }
    spreadChart.update();
}

fetchPrices();
setInterval(fetchPrices, 3000);
</script>

</body>
</html>
